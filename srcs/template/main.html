<!-- @format -->

<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8" />
    <title>게시판</title>
    <link rel="stylesheet" type="text/css" href="../css/feed.css" />
    <link rel="stylesheet" href="../css/header.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <header>
      <div class="header_row first_col">
        <a href="/">logo</a>
      </div>
      <div class="header_row second_col">
        <form method="post" class="search_form">
          <input type="text" id="searchbar" placeholder="Search user" />
          <button type="submit" id="searchbutton" name="search">
            <span class="glyphicon glyphicon-search"></span>
          </button>
        </form>
      </div>
      <div class="header_row third_col">
        <div class="col_block">
          <a href="/">
            <button>profile</button>
          </a>
        </div>
        <div class="col_block">
          <a href="../member/logout.php">
            <button>log out</button>
          </a>
        </div>
      </div>
      <div class="header_row">
        <div class="dropdown">
          <button>
            <span class="glyphicon glyphicon-align-justify"></span>
          </button>
          <div class="dropdown-content">
            <form method="post">
              <a href="/">profile</a>
              <a href="../member/logout.php">logout</a>
            </form>
          </div>
        </div>
      </div>
    </header>
    <div class="feed_body">
      <div class="write_feed">
        <form action="write_ok.php" method="post">
          <div class="wi_line"></div>
          <div id="in_content">
            <textarea
              name="content"
              id="ucontent"
              placeholder="What's in your mind?"
              required
            ></textarea>
          </div>
          <div class="bottom_row">
            <div id="in_file">
              <div class="file_box">
                <input
                  class="upload_name"
                  value="이미지를 업로드 해 주세요."
                  disabled="disabled"
                />
                <label for="b_file">
                  <span>upload</span>
                </label>
                <input type="file" id="b_file" class="file_hidden" />
              </div>
            </div>
            <div class="bt_se">
              <button type="submit">write</button>
            </div>
          </div>
        </form>
      </div>
      <ul class="timeline">
        <li>
          <div class="feed_box">
            <div class="feed_box_top">
              name
            </div>
          </div>
        </li>
        <li>
          <div class="feed_box">
            <div class="feed_box_top">
              name1
            </div>
          </div>
        </li>
        <li>
          <div class="feed_box">
            <div class="feed_box_top">
              name2
            </div>
          </div>
        </li>
      </ul>
    </div>
  </body>
  <script>
    var fileTarget = $(".file_box .file_hidden");

    fileTarget.on("change", function() {
      if (window.FileReader) {
        // 파일명 추출
        var filename = $(this)[0].files[0].name;
      } else {
        // Old IE 파일명 추출
        var filename = $(this)
          .val()
          .split("/")
          .pop()
          .split("\\")
          .pop();
      }

      $(this)
        .siblings(".upload_name")
        .val(filename);
    });
    /* 파일명 가져오기 end */

    /* 파일 이미지 가져오기 start */
    var imgTarget = $(".file_box .file_hidden");

    imgTarget.on("change", function() {
      var parent = $(this).parent();
      parent.children(".upload-display").remove();

      if (window.FileReader) {
        //image 파일인지 검사
        if (!$(this)[0].files[0].type.match(/image\//)) return;

        var reader = new FileReader();
        reader.onload = function(e) {
          var src = e.target.result;
          console.log(e);
          console.log(e.target);
          parent.prepend(
            '<div class="upload-display"><img src="' +
              src +
              '" class="upload-thumb"></div>'
          );
        };
        reader.readAsDataURL($(this)[0].files[0]);
      } else {
        $(this)[0].select();
        $(this)[0].blur();
        var imgSrc = document.selection.createRange().text;
        parent.prepend(
          '<div class="upload-display"><img class="upload-thumb"></div>'
        );

        var img = $(this)
          .siblings(".upload-display")
          .find("img");
        img[0].style.filter =
          "progid:DXImageTransform.Microsoft.AlphaImageLoader(enable='true',sizingMethod='scale',src=\"" +
          imgSrc +
          '")';
      }
    });
  </script>
</html>
